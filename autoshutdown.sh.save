# Masuk ke folder server
cd /home/nama_user_lo/mcserver

# Cek jumlah player lewat log server atau rcon (cara termudah lewat log)
# Kita cari pesan 'There are 0 of a max' yang biasanya muncul pas command /list
screen -S minecraft -X stuff "list^M"
sleep 2
PLAYER_COUNT=$(tail -n 10 logs/latest.log | grep "There are" | tail -n 1 | awk '{print $3}')

if [ "$PLAYER_COUNT" == "0" ]; then
    echo "Server kosong, mematikan PC dalam 10 menit..."
    sleep 600
    # Cek sekali lagi buat mastiin beneran kosong
    screen -S minecraft -X stuff "list^M"
    sleep 2
    PLAYER_COUNT_AGAIN=$(tail -n 10 logs/latest.log | grep "There are" | tail -n 1 | awk '{print $3}')
    
    if [ "$PLAYER_COUNT_AGAIN" == "0" ]; then
        sudo /sbin/poweroff
    fi
else
    echo "Masih ada player online ($PLAYER_COUNT), batalkan shutdown."
fi
